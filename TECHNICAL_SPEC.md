# Technical specification — PoMoDoRo

Версия: 1.0
Дата: 2026-01-15
Автор: PoMoDoRo team

Цель проекта
------------
PoMoDoRo — мобильное Android‑приложение для управления временем по технике Pomodoro. Цель — помочь пользователю повышать продуктивность и управлять вниманием через простые циклы работы и отдыха, а также сохранять историю и базовую аналитику.

Целевая аудитория
-----------------
- Студенты, готовящиеся к экзаменам или выполняющие задания.
- Профессионалы, работающие над задачами требующими продолжительной концентрации.
- Люди, изучающие навыки/языки, ведущие домашние проекты.

Определения
-----------
- Pomodoro — одна сессия фокусной работы (по умолчанию 25 минут).
- Short Break — короткий перерыв (по умолчанию 5 минут).
- Long Break — длинный перерыв после нескольких Pomodoro (по умолчанию 15–30 мин).
- Task — пользовательская задача/задача, к которой привязаны Pomodoro сессии.
- SessionRecord — запись о завершённой Pomodoro (включает такс, время начала/конца и статус).

Функциональные требования
-------------------------
1. Работа с задачами
   - Пользователь может создавать, редактировать и удалять задачи (Task).
   - Каждая задача содержит: id, title, optional description, estimatedPomodoros, colorTag, createdAt, updatedAt.

2. Таймер Pomodoro
   - Пользователь может запустить таймер для выбранной задачи.
   - Возможности: запуск/пауза/сброс, пропуск перерыва, переключение задач.
   - По окончании таймера отправлять локальное уведомление и (по желанию) воспроизводить звук.
   - Поддерживать настройки длительностей (pomodoro, shortBreak, longBreak) и автозапуск следующего периода.

3. Циклы и подсчёт
   - Автоматическое переключение между Pomodoro и Short Break. После N (по умолчанию 4) Pomodoro включается Long Break.
   - Отслеживание текущего счётчика Pomodoro в сессии.

4. История и аналитика
   - Хранить список завершённых сессий (SessionRecord) локально (Room DB), с датой, duration, taskId, interruptedFlag.
   - Просмотр статистики: Pomodoro за день/неделю/месяц, суммарное время, список задач с количеством сессий.

5. Фоновая работа
   - Таймер должен корректно работать в фоне: при сворачивании приложения, перезагрузке устройства или при выключенном экране.
   - Использовать Foreground Service или WorkManager + AlarmManager (в зависимости от версии Android) для надёжности и соблюдения ограничений OS.

6. Уведомления
   - Локальные уведомления при смене состояния таймера (начало/конец, перерыв/рабочая сессия). Уведомления кликабельны и возвращают в приложение.

7. Настройки и персонализация
   - Конфигурация временных параметров, автозапуск, звуки, режим "Не беспокоить" (приглушать звуки во время сессий) и тема приложения (light/dark/auto).

8. Экспорт/импорт данных (опционально)
   - Экспорт истории в CSV/JSON и импорт бэкапа.

9. Локализация
   - Поддержка русского и английского языков; структура string‑ресурсов.

Нефункциональные требования
---------------------------
- Минимальная SDK: API 21 (Android 5.0) — адаптировать по требованию.
- Целевой SDK: последний стабильный (рекомендация API 33+).
- Производительность: минимальное потребление батареи при фоновой работе; не держать активные wake‑локи.
- Надёжность: таймеры не должны теряться при сворачивании приложения или при смене конфигурации.
- Безопасность: все данные хранятся локально; опционально — шифрование резервных копий.
- Тестируемость: модульная архитектура (слои), единичные тесты для логики таймера и репозитория.

Архитектура
-----------
- Рекомендуемая архитектура: MVVM + Repository.
- Компоненты: UI (Activities/Fragments), ViewModel, Domain/UseCases (логика таймера, подсчёты), Repository (Room + DataSource), Service (Foreground service для таймера), Notifications.
- DI: Hilt (или Dagger2) для внедрения зависимостей.

Модель данных (вкратце)
----------------------
Task
- id: Long (PK)
- title: String
- description: String?
- estimatedPomodoros: Int
- colorTag: Int
- createdAt: Long
- updatedAt: Long

SessionRecord
- id: Long (PK)
- taskId: Long? (FK)
- startAt: Long
- endAt: Long
- duration: Long
- type: enum {POMODORO, SHORT_BREAK, LONG_BREAK}
- interrupted: Boolean

Сценарии использования (User Stories)
-------------------------------------
1. Как пользователь, я хочу создать задачу с названием и описанием, чтобы привязывать к ней Pomodoro.
2. Как пользователь, я хочу запустить таймер и получить уведомление по окончании, чтобы начать перерыв.
3. Как пользователь, я хочу просматривать статистику по дням/неделям, чтобы понимать продуктивность.
4. Как пользователь, я хочу изменить длительность Pomodoro и перерывов в настройках.
5. Как пользователь, мне важно чтобы таймер работал, даже если приложение свернуто.

UX/взаимодействие
-----------------
- Главный экран: список задач и кнопка для создания новой; рядом стопка карточек с быстрыми действиями (старт/пауза) и индикатором текущего прогресса.
- Экран таймера: крупный таймер с кнопками старт/пауза/сброс и информацией о текущей задаче.
- Экран статистики: график/история и фильтрация по датам.

Реализация фонового таймера
--------------------------
- Для API >= 26 — использовать Foreground Service с уведомлением о текущем таймере.
- Для более старых API — использовать AlarmManager + BroadcastReceiver или WorkManager с точным триггером.
- При старте таймера сохранять состояние в Room (текущее время окончания, taskId, mode), чтобы восстановиться после убийства процесса.

Приёмочные критерии
-------------------
- Таймер запускается, паузится и возобновляется корректно; состояние сохраняется при сворачивании и перезапуске приложения.
- После N Pomodoro автоматически запускается Long Break.
- Записи сессий сохраняются в Room и доступны в статистике.
- Уведомления корректно отображаются и ведут обратно в приложение.

Тестирование
-----------
- Unit tests: логика переключения Pomodoro/перерывов, расчёт статистики, репозитории (мокированные).
- Instrumentation tests: UI сценарии, проверка сохранения состояний, интеграция с Room.
- Ручное тестирование: проверка поведения при сворачивании приложения, при перезагрузке устройства, при отключении звука.

CI/CD рекомендации
------------------
- GitHub Actions workflow для сборки Gradle и running unit tests на каждом PR.
- Опционально: настроить Flavors для debug/release и автоматический релиз APK в GitHub Releases или Firebase App Distribution.

План разработки (микрозадачи)
----------------------------
1. Настроить базовый проект и зависимостис (Room, Hilt, Lifecycle, WorkManager).
2. Реализовать модель данных и репозиторий.
3. Реализовать ViewModels и простой UI для управления задачами и таймером.
4. Добавить foreground service для таймера.
5. История сессий и экран статистики.
6. Тесты и CI.

